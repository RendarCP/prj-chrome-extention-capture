import{r as a,j as o,c as A,R as L}from"./client-BW4HFQ8H.js";function W(){const[c,v]=a.useState(null),[l,j]=a.useState(!1),[P,i]=a.useState(null),[C,w]=a.useState(0),[x,b]=a.useState(null);a.useEffect(()=>{x&&(v(x),b(null))},[x]),console.log("screenshot",c);const R=e=>e.startsWith("chrome://")||e.startsWith("chrome-extension://")||e.startsWith("chrome.google.com/webstore")||e.startsWith("chrome.google.com/extensions"),T=async()=>{try{i(null);const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.url)return;if(R(e.url)){i("이 페이지에서는 캡처할 수 없습니다.");return}const f=await chrome.tabs.captureVisibleTab();b(f)}catch(e){console.error("스크린샷 캡처 실패:",e),i("스크린샷 캡처에 실패했습니다.")}},I=async()=>{try{i(null),j(!0),w(0);const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id||!e.url){console.error("탭 ID 또는 URL이 없습니다.");return}if(R(e.url)){i("이 페이지에서는 캡처할 수 없습니다.");return}await chrome.scripting.executeScript({target:{tabId:e.id},files:["contentScript.js"]});const f=await chrome.tabs.sendMessage(e.id,{action:"captureFullPage"}),{fullHeight:u}=f,d=window.innerHeight,n=[],y=async(t=0)=>{try{return await chrome.tabs.captureVisibleTab()}catch(r){if(r.toString().includes("MAX_CAPTURE_VISIBLE_TAB_CALLS_PER_SECOND")&&t<3)return await new Promise(s=>setTimeout(s,500)),y(t+1);throw r}};await chrome.tabs.sendMessage(e.id,{action:"prepareCapture"}),await new Promise(t=>setTimeout(t,100)),await chrome.tabs.sendMessage(e.id,{action:"scrollTo",position:0}),await new Promise(t=>setTimeout(t,100));const k=await y();n.push(k),await chrome.tabs.sendMessage(e.id,{action:"hideFixedElements"});let m=d,E=0;for(;m<=u;)try{await chrome.tabs.sendMessage(e.id,{action:"scrollTo",position:m}),await new Promise(h=>setTimeout(h,100));const t=await chrome.tabs.sendMessage(e.id,{action:"getScrollPosition"});if(t.scrollPosition===E)break;E=t.scrollPosition;const r=await y();n.push(r);const s=Math.min(Math.round(m/u*100),100);w(s),m+=d}catch(t){console.error("캡처 중 에러 발생:",t),i("캡처 중 오류가 발생했습니다. 다시 시도해주세요.");break}await chrome.tabs.sendMessage(e.id,{action:"showFixedElements"}),await chrome.tabs.sendMessage(e.id,{action:"restoreStyles"});const p=document.createElement("canvas"),S=p.getContext("2d");if(!S)throw new Error("캔버스 컨텍스트를 가져올 수 없습니다.");const F=await new Promise(t=>{const r=new Image;r.onload=()=>t(r),r.src=n[0]});p.width=F.width,p.height=u;let g=0;for(let t=0;t<n.length;t++){const r=await new Promise(s=>{const h=new Image;h.onload=()=>s(h),h.src=n[t]});if(t===n.length-1){const s=u-g;s>0&&S.drawImage(r,0,r.height-s,r.width,s,0,g,r.width,s)}else S.drawImage(r,0,0,r.width,d,0,g,r.width,d),g+=d}const U=p.toDataURL();b(U)}catch(e){console.error("전체 페이지 캡처 실패:",e),i("전체 페이지 캡처에 실패했습니다.")}finally{j(!1),w(0)}},M=async()=>{if(c)try{await chrome.storage.local.set({currentScreenshot:c});const e=chrome.runtime.getURL("editor.html");console.log("편집 페이지 URL:",e),chrome.tabs.create({url:e})}catch(e){console.error("스크린샷 저장 실패:",e),i("스크린샷 저장에 실패했습니다.")}else console.error("screenshot이 null입니다")};return o.jsxs("div",{className:"App",style:{width:"400px",padding:"20px"},children:[o.jsx("h1",{style:{fontSize:"20px",marginBottom:"20px"},children:"스크린샷 캡처"}),P&&o.jsx("div",{style:{color:"red",marginBottom:"10px"},children:P}),c?o.jsxs("div",{children:[o.jsx("img",{src:c,alt:"캡처된 화면",style:{maxWidth:"100%",marginBottom:"10px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}}),o.jsx("button",{onClick:M,style:{padding:"10px",fontSize:"14px",cursor:"pointer",backgroundColor:"#FF9800",color:"white",border:"none",borderRadius:"4px"},children:"편집하기"})]}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[o.jsx("button",{onClick:T,style:{padding:"10px",fontSize:"14px",cursor:"pointer",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px"},children:"현재 화면 캡처"}),o.jsx("button",{onClick:I,disabled:l,style:{padding:"10px",fontSize:"14px",cursor:l?"not-allowed":"pointer",backgroundColor:l?"#cccccc":"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:l?`캡처 중... ${C}%`:"전체 페이지 캡처"}),l&&o.jsx("div",{style:{marginTop:"10px"},children:o.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#f0f0f0",borderRadius:"2px",overflow:"hidden"},children:o.jsx("div",{style:{width:`${C}%`,height:"100%",backgroundColor:"#2196F3",transition:"width 0.3s ease"}})})})]})]})}const B=A.createRoot(document.getElementById("root"));B.render(o.jsx(L.StrictMode,{children:o.jsx(W,{})}));
